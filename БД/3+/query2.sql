use K_MyBase;

IF EXISTS (SELECT * FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_NAME = N'ЗАКАЗЫ')
drop table ЗАКАЗЫ;
IF EXISTS (SELECT * FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_NAME = N'МАРШРУТЫ')
drop table МАРШРУТЫ;
IF EXISTS (SELECT * FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_NAME = N'ВОДИТЕЛИ')
drop table ВОДИТЕЛИ;

CREATE table МАРШРУТЫ
(
	ID_маршрута int primary key,
	Название_маршрута nvarchar(30),
	Дальность int not null,
	Оплата int not null
) on FG1;

CREATE table ВОДИТЕЛИ
(
	ID_водителя int primary key,
	Фамилия nvarchar(15) not null,
	Имя nvarchar(15) not null,
	Отчество nvarchar(15) not null,
	Стаж tinyint not null
) on FG1;

CREATE table ЗАКАЗЫ
(
	Номер_перевозки int primary key,
	ID_маршрута int not null foreign key references МАРШРУТЫ(ID_маршрута),
	ID_водителя int not null foreign key references ВОДИТЕЛИ(ID_водителя), 
	Дата_отправления date not null,
	Дата_возвращения date not null
) on FG1;

ALTER Table ВОДИТЕЛИ ADD Дата_рождения date; 
ALTER Table ВОДИТЕЛИ ADD Пол nchar(1) default 'м' check (Пол in ('м', 'ж')); 
ALTER Table ВОДИТЕЛИ DROP Column Дата_рождения;

INSERT into ВОДИТЕЛИ Values
	(1001, 'Мороз',  	'Алиса',	'Петровна',    10, 'ж'),
	(1002, 'Петров',	'Петр',		'Петрович',     5, 'м'),
	(1003, 'Сергеев',	'Сергеев',	'Сергеевич',   19, 'м'),
	(1004, 'Евгеньева', 'Евгения',	'Евгеньевна',  11, 'ж'),
	(1005, 'Андреев',	'Андрей',	'Андреевич',    8, 'м'),
	(1006, 'Васильев',	'Василий',	'Васильевич',  27, 'м'),
	(1007, 'Алексеев',	'Алексей',	'Алексеевич',  12, 'м'),
	(1008, 'Егоров',	'Егор',		'Егорович',	   36, 'м'),
	(1009, 'Григорьев', 'Григорий', 'Григорьевич', 27, 'м'),
	(1010, 'Дмитриев',	'Дмитрий',	'Дмитриевич',   7, 'м'),
	(1011, 'Тарасенко',	'Тарас',	'Тарасович',   14, 'м')

INSERT into МАРШРУТЫ Values
	(900001, 'Минск-Москва',	   718,  2533),
	(900002, 'Минск-С.-Петербург', 777,  5566),
	(900003, 'Минск-Смоленск',	   378,  1114),
	(900004, 'Минск-Казань',	   1538, 8556),
	(900005, 'Минск-Варшава',	   546,  6526),
	(900006, 'Минск-Брест',		   351,  2123),
	(900007, 'Минск-Варшава',	   546,  1555),
	(900008, 'Минск-Казань',	   1538, 7244),
	(900009, 'Минск-Вильнюс',	   184,  6251),
	(900010, 'Минск-Орша',		   220,  1766)

INSERT into ЗАКАЗЫ Values
	(1,  900001, 1001, '2024-02-02', '2024-02-04'),
	(2,  900002, 1002, '2024-01-19', '2024-01-22'),
	(3,  900003, 1003, '2023-12-06', '2024-12-07'),
	(4,  900004, 1004, '2024-01-31', '2024-02-04'),
	(5,  900005, 1005, '2024-01-04', '2024-01-06'),
	(6,  900006, 1006, '2024-02-13', '2024-02-14'),
	(7,  900007, 1007, '2023-12-29', '2023-12-31'),
	(8,  900008, 1008, '2024-01-24', '2024-01-28'),
	(9,  900009, 1009, '2024-02-09', '2024-02-11'),
	(10, 900010, 1010, '2024-02-16', '2024-02-17')

SELECT Фамилия, Стаж From ВОДИТЕЛИ;
SELECT count(*)[Кол-во строк в таблице] From ВОДИТЕЛИ; 
SELECT * FROM ВОДИТЕЛИ;

UPDATE ВОДИТЕЛИ set Пол = 'ж';
UPDATE ВОДИТЕЛИ set Стаж = Стаж+1 Where (Отчество = 'Петрович' or Отчество = 'Петровна');

SELECT * FROM ВОДИТЕЛИ;